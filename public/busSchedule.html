<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="images/witsGoLogo.png" type="image/x-icon">
    <title>Bus Schedule</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600&family=Roboto:wght@400&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="styles/busSchedule.css">
    <link rel="stylesheet" href="styles/navBar.css">

    <script type="module" defer src="scripts/verifylogin.js"></script> <!-- This script should be put on everypage -->

</head>
<body>
    <header>
        <img class="profile-img" src="images/pfp.jpg" alt="Profile Picture" id="profile-picture">
        <h1>Bus Schedule</h1>
    </header>


    <div class="dropdown-container">
        <select name="days" id="days" onchange="toggleSchedule()">
            <option value="Week">Monday-Friday</option>
            <option value="Weekend">Saturday-Sunday and Public Holidays</option>
        </select>
        
        <select name="destination" id="destination"  onchange="filterRoutesByDestination()">
            <option value="" disabled selected>Destinations:</option>
            <option value="AMIC">AMIC DECK- AMIC</option>
            <option value="EOH">ERNST OPPENHEIMER HALL OF RESIDENCE- EOH</option>
            <option value="KNK">KNOCKANDO HALLS OF RESIDENCE- KNK</option>
            <option value="NSW">NOSWAL HALL (1 STIEMENS STREET, BRAAMFONTEIN)- NSW</option>
            <option value="ROSEBANK" id="rosebank-option">ROSEBANK MALL- ROSEBANK</option>
            <option value="WEC">WITS EDUCATION CAMPUS- WEC</option>
            <option value="WJ">WITS JUNCTION RESIDENCE- WJ</option>
        </select>
    </div>

    <section class="schedule-container">
        <!-- Weekday schedule -->
        <table id="weekday-schedule">
            <thead>
                <tr>
                    <th>Route</th>
                    <th>Route Details</th>
                    <th>Time</th>
                    <th>Interval</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Route 1 - Full Circuit</td>
                    <td>AMIC > NSW > WJ > WEC > EOH > KNK > AMIC</td>
                    <td>06:30 to 17:00</td>
                    <td>Every 15 – 20 minutes, “drop & go”</td>
                </tr>
                <tr>
                    <td></td>
                    <td>AMIC > KNK > EOH > WEC > WJ > NSW > AMIC</td>
                    <td>06:30 to 18:00</td>
                    <td>Every 15 – 20 minutes, “drop & go” (Reverse Circuit)</td>
                </tr>
                <tr>
                    <td></td>
                    <td>AMIC > KNK > EOH > WEC > WJ > NSW > AMIC</td>
                    <td>18:30 to 23:30</td>
                    <td>Reverse circuit on the half hour</td>
                </tr>
                <tr>
                    <td></td>
                    <td>AMIC > KNK > EOH > WEC > WJ > NSW > AMIC</td>
                    <td>18:00 to 00:00</td>
                    <td>Normal circuit on the hour</td>
                </tr>
                <tr>
                    <td>Route 2B</td>
                    <td>NSW > WEC > AMIC > NSW > WEC</td>
                    <td>06:45 to 08:45</td>
                    <td>Every 30 minutes (Shuttle)</td>
                </tr>
                <tr>
                    <td></td>
                    <td>NSW > WEC > AMIC > NSW > WEC</td>
                    <td>09:00 to 18:00</td>
                    <td>Hourly on the hour from WEC</td>
                </tr>
                <tr>
                    <td>Route 3A</td>
                    <td>WJ > AMIC > WJ</td>
                    <td>07:00 to 09:00</td>
                    <td>Every 15 – 20 minutes (Shuttle)</td>
                </tr>
                <tr>
                    <td></td>
                    <td>WJ > AMIC > WJ</td>
                    <td>09:00 to 17:00</td>
                    <td>Hourly on the hour from WJ</td>
                </tr>
                <tr>
                    <td></td>
                    <td>WJ > AMIC > WJ</td>
                    <td>12:00 to 14:00</td>
                    <td>Every 20 minutes (Shuttle)</td>
                </tr>
                <tr>
                    <td></td>
                    <td>WJ > AMIC > WJ</td>
                    <td>16:00 to 18:00</td>
                    <td>Every 20 minutes (Shuttle)</td>
                </tr>
                <tr>
                    <td></td>
                    <td>WJ > AMIC > WJ</td>
                    <td>09:30 to 17:30</td>
                    <td>Hourly on the half hour from AMIC</td>
                </tr>
                <tr>
                    <td></td>
                    <td>WJ > AMIC > WJ</td>
                    <td>18:30 to 23:30</td>
                    <td>Hourly (Departs WJ)</td>
                </tr>
                <tr>
                    <td></td>
                    <td>WJ > AMIC > WJ</td>
                    <td>18:00 to 00:00</td>
                    <td>Hourly (Departs AMIC)</td>
                </tr>
                <tr>
                    <td>Route 3B</td>
                    <td>WJ > WEC > WJ</td>
                    <td>06:45 to 09:15</td>
                    <td>Every 15 – 20 minutes (Shuttle)</td>
                </tr>
                <tr>
                    <td></td>
                    <td>WJ > WEC > WJ</td>
                    <td>09:30 to 15:00</td>
                    <td>Every 30 minutes (Departs WJ)</td>
                </tr>
                <tr>
                    <td></td>
                    <td>WJ > WEC > WJ</td>
                    <td>15:20 to 17:40</td>
                    <td>Every 20 minutes (Departs WEC)</td>
                </tr>
                <tr>
                    <td></td>
                    <td>WJ > WEC > WJ</td>
                    <td>18:30 to 23:30</td>
                    <td>Hourly (Departs WJ)</td>
                </tr>
                <tr>
                    <td></td>
                    <td>WJ > WEC > WJ</td>
                    <td>18:00 to 00:00</td>
                    <td>Hourly (Departs WEC)</td>
                </tr>
                <tr>
                    <td>Route 4A</td>
                    <td>AMIC > NSW > WEC</td>
                    <td>06:40 to 17:40</td>
                    <td>Every 15 – 20 minutes (Shuttle)</td>
                </tr>
                <tr>
                    <td>Route 4</td>
                    <td>WEC > NSW > AMIC</td>
                    <td>07:00 to 18:00</td>
                    <td>Every 15 – 20 minutes (Shuttle)</td>
                </tr>
                <tr>
                    <td>Route 4B</td>
                    <td>NSW > WEC > AMIC</td>
                    <td>07:00 to 09:00</td>
                    <td>Every 20 minutes (Shuttle)</td>
                </tr>
                <tr>
                    <td></td>
                    <td>NSW > WEC > AMIC</td>
                    <td>10:00 to 14:00</td>
                    <td>Hourly on the half hour from WEC</td>
                </tr>
                <tr>
                    <td></td>
                    <td>NSW > WEC > AMIC</td>
                    <td>16:30 to 18:00</td>
                    <td>Continuous shuttle, “drop & go”</td>
                </tr>
                <tr>
                    <td>Route 5</td>
                    <td>EOH > KNK > AMIC</td>
                    <td>06:40 to 08:30</td>
                    <td>Every 15 minutes (Shuttle from Rock Ridge Rd)</td>
                </tr>
                <tr>
                    <td></td>
                    <td>AMIC > EOH > KNK (Rock Ridge Rd) > AMIC</td>
                    <td>08:30 to 14:30</td>
                    <td>Every 30 minutes</td>
                </tr>
                <tr>
                    <td></td>
                    <td>AMIC > EOH > KNK (Rock Ridge Rd) > AMIC</td>
                    <td>16:30 to 18:00</td>
                    <td>Continuous shuttle, “drop & go”</td>
                </tr>
            </tbody>
        </table>

        <!-- Weekend schedule -->
        <table id="weekend-schedule" class="hidden">
            <thead>
                <tr>
                    <th>Route</th>
                    <th>Route Details</th>
                    <th>Time</th>
                    <th>Interval</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Route 1 - Full Circuit</td>
                    <td>AMIC > NSW > WJ (PARKLANE) > WEC > EOH > KNK > AMIC</td>
                    <td>09:00 to 20:00</td>
                    <td>Normal circuit on the hour</td>
                </tr>
                <tr>
                    <td>Route 3C</td>
                    <td>WJ > WEC > AMIC > WEC > WJ</td>
                    <td>09:00 to 10:00</td>
                    <td>Continuous shuttle, “drop & go”</td>
                </tr>
                <tr>
                    <td>Route 3C</td>
                    <td>WJ > WEC > AMIC > WEC > WJ</td>
                    <td>10:00 to 20:00</td>
                    <td>Hourly on the hour from WJ</td>
                </tr>
                <tr>
                    <td>Route 6A</td>
                    <td>AMIC > KNK > ROSEBANK > KNK > AMIC</td>
                    <td>Saturdays: 09:00 to 17:00</td>
                    <td>Every hour from AMIC (Last dep. from Rosebank at 17:00)</td>
                </tr>
                <tr>
                    <td>Route 6A</td>
                    <td>AMIC > KNK > ROSEBANK > KNK > AMIC</td>
                    <td>Sundays: 09:00 to 15:00</td>
                    <td>Hourly (Last dep. from Rosebank at 15:00)</td>
                </tr>
                <tr>
                    <td>Route 6B</td>
                    <td>AMIC > NSW > ROSEBANK > NSW > AMIC</td>
                    <td>Saturdays: 09:00 to 17:00</td>
                    <td>Every hour from AMIC (Last dep. from Rosebank at 17:00)</td>
                </tr>
                <tr>
                    <td>Route 6B</td>
                    <td>AMIC > NSW > ROSEBANK > NSW > AMIC</td>
                    <td>Sundays: 09:00 to 15:00</td>
                    <td>Hourly (Last dep. from Rosebank at 15:00)</td>
                </tr>
                <tr>
                    <td>Route 6C</td>
                    <td>WEC > EOH > ROSEBANK > EOH > WEC</td>
                    <td>Saturdays: 09:00 to 17:00</td>
                    <td>Every hour from WEC (Last dep. from Rosebank at 17:00)</td>
                </tr>
                <tr>
                    <td>Route 6C</td>
                    <td>WEC > EOH > ROSEBANK > EOH > WEC</td>
                    <td>Sundays: 09:00 to 15:00</td>
                    <td>Hourly (Last dep. from Rosebank at 15:00)</td>
                </tr>
                <tr>
                    <td>Route 6D</td>
                    <td>WJ > ROSEBANK > WJ</td>
                    <td>Saturdays: 09:00 to 17:00</td>
                    <td>Every hour from WJ (Last dep. from Rosebank at 17:00)</td>
                </tr>
                <tr>
                    <td>Route 6D</td>
                    <td>WJ > ROSEBANK > WJ</td>
                    <td>Sundays: 09:00 to 15:00</td>
                    <td>Hourly (Last dep. from Rosebank at 15:00)</td>
                </tr>
            </tbody>
        </table>
    </section>

    <section class="navbar">
        <a href="navigation.html">
            <img src="icons/nav-grey.png" alt="Nav Icon">
            <section class="text">Navigation</section>
        </a>
        <a href="rental.html">
            <img src="icons/rent-grey.png" alt="Rent Icon">
            <section class="text">Renting</section>
        </a>
        <a href="busSchedule.html">
            <img src="icons/schedule-purple.png" alt="Schedule Icon">
            <section class="text">Schedule</section>
        </a>
        <a href="realTimeTracking.html">
            <img src="icons/tracking-grey.png" alt="Tracking Icon">
            <section class="text">Tracking</section>
        </a>
    </section>

    <!-- <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <script type="module">

        import { serverUrl, clientUrl } from './scripts/constants.js';

        document.querySelector('.schedule-container').addEventListener('click', function () {
            this.classList.toggle('expanded');
        });

        document.addEventListener('DOMContentLoaded', () => {
            const scheduleContainer = document.querySelector('.schedule-container');
            let fullText = '';

            fetch(`${serverUrl}/v1/schedule/pdf-text`)
                .then(response => response.text())
                .then(data => {
                    fullText = data;
                    updateSchedule();
                })
                .catch(err => {
                    console.error('Error fetching the PDF text:', err);
                });

            const updateSchedule = () => {
                const dayValue = document.getElementById('days').value;
                const destinationValue = document.getElementById('destination').value;

                let displayText = '';

                if (dayValue === 'Week') {
                    displayText = extractText(fullText, 'MONDAY TO FRIDAY', 'CONTACT US');
                    //Remove Rosebank option if not Weekend 
                    document.getElementById('rosebank-option').style.display = 'none';
                } else if (dayValue === 'Weekend') {
                    displayText = extractText(fullText, 'SATURDAY AND SUNDAY', '•');
                    document.getElementById('rosebank-option').style.display = 'block';
                } else {
                    displayText = fullText;
                    document.getElementById('rosebank-option').style.display = 'block';
                }

                if (destinationValue) {
                    displayText = filterByDestination(displayText, destinationValue);
                }

                scheduleContainer.innerHTML = displayText || fullText;
            };

            const extractText = (text, startKeyword, endKeyword) => {
                const startIndex = text.indexOf(startKeyword);
                const endIndex = text.indexOf(endKeyword);

                if (startIndex === -1 || endIndex === -1 || startIndex >= endIndex) {
                    return '';
                }

                return text.substring(startIndex, endIndex).trim();
            };

            const filterByDestination = (text, destination) => {
                const routeStartKeyword = 'Route';
                const destinationKeyword = destination;
                let filteredText = '';
                let index = 0;

                while (index < text.length) {
                    const routeStartIndex = text.indexOf(routeStartKeyword, index);
                    if (routeStartIndex === -1) break;

                    const routeEndIndex = text.indexOf(routeStartKeyword, routeStartIndex + routeStartKeyword.length);
                    const routeText = text.substring(routeStartIndex, routeEndIndex !== -1 ? routeEndIndex : undefined);

                    if (routeText.includes(destinationKeyword)) {
                        filteredText += routeText + '<br><br>';
                    }

                    index = routeEndIndex !== -1 ? routeEndIndex : text.length;
                }

                return filteredText;
            };

            document.getElementById('days').addEventListener('change', updateSchedule);
            document.getElementById('destination').addEventListener('change', updateSchedule);
        });
    </script> -->

    <script>
        // Function to toggle between weekday and weekend schedules
        function toggleSchedule() {
            const daysDropdown = document.getElementById('days');
            const weekdaySchedule = document.getElementById('weekday-schedule');
            const weekendSchedule = document.getElementById('weekend-schedule');
            const rosebankOption = document.getElementById('rosebank-option');
            const destinationDropdown = document.getElementById('destination');
    
            // Show or hide schedules based on selected days
            if (daysDropdown.value === 'Week') {
                weekdaySchedule.classList.remove('hidden');
                weekendSchedule.classList.add('hidden');
                rosebankOption.disabled = true; // Disable Rosebank for weekdays
            } else {
                weekdaySchedule.classList.add('hidden');
                weekendSchedule.classList.remove('hidden');
                rosebankOption.disabled = false; // Enable Rosebank for weekends
            }
    
            // Reset destination to the disabled option
            destinationDropdown.selectedIndex = 0; // Set to the first option ("Destinations:")
            
            // Filter routes based on the new destination selection
            filterRoutesByDestination(); 
        }
    
        // Function to filter routes based on selected destination
        function filterRoutesByDestination() {
            const destinationDropdown = document.getElementById('destination');
            const selectedDestination = destinationDropdown.value;
            const weekdaySchedule = document.getElementById('weekday-schedule');
            const weekendSchedule = document.getElementById('weekend-schedule');
    
            // Get all table rows from the visible schedule
            const visibleSchedule = weekdaySchedule.classList.contains('hidden') ? weekendSchedule : weekdaySchedule;
            const rows = visibleSchedule.querySelectorAll('tbody tr');
    
            rows.forEach(row => {
                const routeDetailsCell = row.cells[1];
                if (routeDetailsCell) {
                    const routeDetails = routeDetailsCell.textContent;
    
                    if (routeDetails.includes(selectedDestination)) {
                        row.classList.remove('hidden');
                        highlightDestination(routeDetailsCell, selectedDestination);
                    } else {
                        row.classList.add('hidden');
                    }
                }
            });
        }
    
        // Function to highlight the selected destination within the route details
        function highlightDestination(cell, destination) {
            const regex = new RegExp(destination, 'gi'); // Case-insensitive search
            const originalText = cell.textContent;
            const highlightedText = originalText.replace(regex, match => `<span class="highlight">${match}</span>`);
            cell.innerHTML = highlightedText;
        }
    
        // Initial call to set the correct schedule on page load
        toggleSchedule();
    </script>
</body>

</html>